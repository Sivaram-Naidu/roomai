<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register for Event - AgentRoomAI</title>
    <link rel="stylesheet" href="register.css" />
  </head>
  <body>
    <div class="form-container">
      <form id="registration-form">
        <h1 id="event-title">Event Registration</h1>

        <!-- This field is hidden, but its value is set by JavaScript -->
        <input type="hidden" id="EventName" name="EventName" />
        <!-- This field is also hidden and used by JS -->
        <input type="hidden" id="PaymentID" name="PaymentID" value="N/A" />

        <div class="form-group">
          <label for="FullName">Full Name</label>
          <input
            type="text"
            id="FullName"
            name="FullName"
            class="form-control"
            required
          />
        </div>

        <div class="form-group">
          <label for="Email">Email Address</label>
          <input
            type="email"
            id="Email"
            name="Email"
            class="form-control"
            required
          />
        </div>

        <div class="form-group">
          <label for="Phone">Phone Number</label>
          <input
            type="tel"
            id="Phone"
            name="Phone"
            class="form-control"
            required
          />
        </div>

        <div class="form-group">
          <label for="OrgName">College / Company Name</label>
          <input
            type="text"
            id="OrgName"
            name="OrgName"
            class="form-control"
            required
          />
        </div>

        <!-- Payment section - hidden by default -->
        <div id="payment-section" style="display: none">
          <p class="payment-instructions">
            You are registering for a paid event. Please complete your payment,
            then paste the Transaction ID below to confirm your registration.
          </p>
          <a
            href="https://razorpay.me/@dehsahkaiprivatelimited"
            target="_blank"
            rel="noopener noreferrer"
            class="payment-btn"
          >
            Pay Now
          </a>
          <div class="form-group" style="margin-top: 20px">
            <label for="PaymentIDInput">Transaction ID</label>
            <input
              type="text"
              id="PaymentIDInput"
              class="form-control"
              placeholder="Paste your Transaction ID here"
            />
          </div>
        </div>

        <button type="submit" class="submit-btn" id="submit-button">
          Register Now
        </button>

        <div id="form-message"></div>
      </form>
    </div>

    <script>
      const form = document.getElementById("registration-form");
      const submitButton = document.getElementById("submit-button");
      const messageDiv = document.getElementById("form-message");

      // Fields
      const eventTitle = document.getElementById("event-title");
      const hiddenEventName = document.getElementById("EventName");
      const hiddenPaymentID = document.getElementById("PaymentID");
      const paymentSection = document.getElementById("payment-section");
      const paymentIDInput = document.getElementById("PaymentIDInput");

      // This is your new Event Script URL
      const SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbw9ZbGMOJAfDQtdLeUBcbuYMlqdBLa8TT1qpRpLhuPLFkh79sz9tl1Vvb8IzJN3lzj9/exec";

      let eventPrice = "free";

      // 1. Get Event Details from URL
      window.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const eventName = urlParams.get("event") || "Event Registration";
        eventPrice = urlParams.get("price") || "free";

        // Set the page title and hidden form field
        eventTitle.textContent = eventName;
        hiddenEventName.value = eventName;

        // Check if this is a paid event
        if (eventPrice !== "free") {
          paymentSection.style.display = "block";
          submitButton.textContent = "Confirm Registration";
          // Make the payment ID field required
          paymentIDInput.required = true;
        } else {
          submitButton.textContent = "Register for Free";
        }
      });

      // 2. Handle Form Submission
      form.addEventListener("submit", function (e) {
        e.preventDefault();

        // If it's a paid event, copy the visible ID to the hidden field
        if (eventPrice !== "free") {
          hiddenPaymentID.value = paymentIDInput.value;
        }

        submitButton.disabled = true;
        submitButton.textContent = "Submitting...";
        messageDiv.textContent = "";
        messageDiv.className = "";

        fetch(SCRIPT_URL, {
          method: "POST",
          body: new FormData(form),
        })
          .then((response) => response.json())
          .then((res) => {
            if (res.result === "success") {
              messageDiv.textContent =
                "Registration successful! Check your email for confirmation.";
              messageDiv.className = "message-success";
              form.reset();
              // After reset, re-populate the hidden event name
              const urlParams = new URLSearchParams(window.location.search);
              hiddenEventName.value =
                urlParams.get("event") || "Event Registration";
            } else {
              throw new Error(res.message || "An unknown error occurred.");
            }
          })
          .catch((error) => {
            messageDiv.textContent = `Error: ${error.message}`;
            messageDiv.className = "message-error";
          })
          .finally(() => {
            submitButton.disabled = false;
            // Reset button text based on price
            if (eventPrice !== "free") {
              submitButton.textContent = "Confirm Registration";
            } else {
              submitButton.textContent = "Register for Free";
            }
          });
      });
    </script>
  </body>
</html>
